Electron Reconstruction
++++++++++++++++++++++++

- cluster finding in the EM calo and track finding in ID

Cluster Finding
---------------
- Form towers of 0.025x0.025, size of second layer of emcal. gives a grid of 200x256 
	- sum energy of all cells
	- energy of cells shared between showed according to fractional area of cell intersect by tower in case of cell shared between towers

Seed cluster finding
--------------------
- use window of 0.075x0.125 (3x5) accross each element of grid. If energy is local maximum and Et>2.5 form seed cluster
- pos of cluster is energy weighted eta/phi barycentre of cells in a window around cell in centre of seed cluster. Window can have smaller size than seed cluster (0.075x0.075 - how is it decided?)
- If two seeds are closer than 0.050x0.050 only one with highest Et kept.

EM cluster formation
---------------------
- Formed by taking all cells inside fixed-size rectangle (sliding window) with size depending on hypothesised particle.
	- 0.075x0.175 [3x7] (0.125x.125) [5x5] for el in barrel (ec)
	- 0.075x0.125 (0.125x.125) for ph in barrel (ec)
	- seed 3x5 was chosen to be subset of final em cluster size
- Energy is sum of
	1. Estimated energy deposited before calo
	2. measured energy in cluster
	3. estimated lateral leakage
	4. estimated long leakage
- Four terms paramat as a fn of meas clus energy in presampler and in the 3 EM calo layers, based on simulation of energy dep in calo and dead material.

- cluster reco expected to be very efficient for true electrons:
	- In MC simulations, the efficiency is about 95% at ET = 5 GeV and 100% for electrons with ET>15GeVfromWandZdecays.
- Apply corrections
- 4 mom is computer using the track direction
-. In the region between the barrel and end-cap calorimeters, the cluster energy is in addition corrected for energy losses using the energy deposit in the crack scintillators.
	
Electron Rec
-------------
https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/ElectronReconstruction

- Tracks extrapolated from last measurement point to middle layer of calo and very loosely matched to seed clusters. Requires delta_et<0.05. delta_phi window is 0.1 on side where trck bends and 0.05 on other size, to account for brem.
-For non-TRT-only tracks cluster is matched to tracks in two steps: first the eta and phi at the origin (of the track) are compared to the eta and phi of the cluster position. If there is reasonable agreement (0.2 in eta, 0.1 in phi),
- If a seed matches at least one inner-detector track (with pT>5 GeV ?), an electron candidate is formed.
- If several track match, the track with Si hits preffered, and one with smallest dR chosen.
-  /etmiss
 
- The information related to the track-to-cluster matching is retained for all the tracks assigned to the reconstructed electron object and is used during the particle identification, as described later in this note.
- A converted photon candidate is created if the associated track is also associated with a secondary vertex. 
- If no match is found to an inner detector track, an unconverted photon candidate is created. 
- electron cluster as 3×7, for |η| < 1.5 and 5×5 for 1.5 < |η| < 2.5.

- In early versions ranked tracks by closeness to E/p==1, and requitred E/p<10 - this caused significant looses due to brem, mostly at large eta.


softe
------
for low-pt (few GeV) can improve efficiency by using track as a astarting point.
- extrapolate to em cal and build cluster
- overlap rem if sahres track with standard el

fwde
----
- no tracking!
- reco only from energy deposits in calo
- group neighbouring cells in 3D, based on sign of energy deposit wrt noise.
- variable number of cells:
	- start with seeds with sig/noise above high threshold t_seed
	- add surrounfing cells above a lower thresh t_cell
	- neighbours can become seeds it thresh t_neighbour int
	- The low threshold at the perimeter ensures that tails of showers are not discarded, while the higher thresholds for seeds and neighbors effectively suppress both electronics and pile-up noise.

-In the standard ATLAS reconstruction, two types of topological clusters are built: 
	- the electromagnetic “633” clusters and the combined “420” clusters. 
	- The “633” cluster can be used to reconstruct EM clusters significantly higher than the noise with minimum fake rate. 
	- The “420 ” is optimized to find efficiently low energy clusters without being overwhelmed by noise. The cut on absolute energy ensures the noise constribution is symmetric. 

- Split if above threshold and have multiple local maxima

- The direction of forward electrons is defined by the barycentre of the cells belonging to the cluster. 
- The energy of the electron is determined simply by summing the energies in the clus- ter cells and is then corrected for energy loss in the passive material before the calorimeter. 
- An electron candidate in the forward region is reconstructed only if it has a small hadronic energy component and a transverse energy of ET > 5 GeV
   
author
-------
Definition of the author
The different egamma algorithms are run independently during reconstruction. For each object reconstructed the algorithm author is kept in variable :

    AuthorUnknown 0x=0 set 1st bit at 0 (means 0 in terms of integer)
    AuthorElectron 0x1 set 1st bit at 1 (means 1 in terms of integer)
    AuthorSofte 0x2 set 2nd bit at 1 (means 2 in terms of integer)
    AuthorPhoton 0x4 set 3rd bit at 1 (means 4 in terms of integer)
    AuthorFrwd 0x8 set 4th bit at 1 (means 8 in terms of integer)
    AuthorRConv 0x10 set 5th bit to 1 (means 16 in terms of integer) 
    
GSF etc
========
https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/BremmPlanning2011
https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/GsfElectronUsage
https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/EgammaTracking172

- by deafult track fitted with pion hypo for material effects - does not account for brem, a common occ given material.
- material in tracker non uniform with high concentration at certain R and at high eta
- active sensors contribute little to material, but electronics, cabline, cooling, mech support do.
- since electron has small mass, raidative losses substantial, alter curvature of trajectory in Bf ield
- leads to inefficiencies, and degradation in est of track parametrs prop to amount of material.
- GSF is non-linear generalisation of the Kalman filter were it estimates process noise and energy loss by a sum of Gaussian's instead of just one Gaussian.

- The use of brem fitter can potentially benefit all physics analyses using electrons, in particular the ones sensitive to low Et electrons and in need of very high efficiency. 
- (when compared to the default, "general purpose" globalchi2 fitter) is not limited to those cases. Improved E/p, lower charge misID, better d0 estimate, etc.. can be eploited by physics analyses to maximize their physics output. 

- In 2011: REFITTING. In 2012, Brem rec from scratch

GSF in (vague) detail
---------------------
- model of brem follows Bethe-Heitler distrbution 
	- z = E_f / E_i
	- f(z) = [-ln z]^{a-1} / Gamma(a), a = t/ln 2 (t = material width in X0)
	- strongly non-gaussian
- approximate as sum of gaussian functons
- splits noise into individual componenets and uses KF to process each one.
- At each surface get n_k terms = n_{k-1} * e_k where e_k is the number of terms to describe the noise (brem) between layers k-1 and k
- Quaickly blows up so apply component reduction
- In TRT, GSF does not give great improvement since material more homo and lower prec meas anyway

2011 Brem refitting
--------------------
- Tracks fitted with pi hypothesis as normal.
- For tracks associated with electron candidates, refit using GSF
- All tracks with pT > 400 MeV, |eta|<2.5 assigned to electron candidates refitted.
	- Improves bending plane quantites (d0, d0sig, phi, q/p)and removes dependence on amount of material traversed.
	- Extrapolation and track-cluster matching uses refitted track. Sometime best match will change (up to 5% at high eta, 0.8% overall). Also improves varaibles used in "Tight" ID (E/P, d0 etc) (up to 5% at high eta)
	- Electron four-mom also improved, particularly at low pT as impact of track params bigger here but brem has largest impact. Also helps with invrairent masses of reconstructed resonance.
	
2012 Brem rec
-------------
- Pattern recognition updated to allow brem in track model
- Ambiguity resolution and TRT extension improved
- Track fitting updated

Pattern Recognition 2012
------------------------
- In RoI of 0.3 around em clusters use Kalman filter allowing for 30% energy loss for electrons with > 1 GeV at each material surface to enable finding more hits.
- This would negatively affect non electron tracks:
	- hadrons undergoing hadronic interactions and producing showers of secondaries.
	- Old tracking would stop at decay point, allowing for energy loss can join hits from secondary particle degrading and biasing iniital track.
- Apply very loose hadronic leakage and R_eta cuts on clusters to stabalise no. RoI wrt pu

Ambiguity Resolution
---------------------
- Brem tracks will generally have higher Chi2 due to energy loss. Don't want to throw them away in favour of fake tracks with less energy loss
- Tracks which fail at ambig resolution and in RoI are refitted using a different Global Chi2 fit with electron hypothesis. Also use this in TRT extension.

Better Chi2 Fit
--------------------
- In pion hypothesis can neglect energy loss term as particles are m-i-p to reduce complexity of the fit
- In electron not the case!
- Locate most significant brem by fitting without MS term, sigma_{delta E} fixed to 50 MeV and inspecting energy loss fit pulls
- Then refit with only energy loss term for most significant brem, with sigma_{delta E} set according to amount of material and momentum of track, and with all MS terms.
- Significantly improves track param resolution, and gives almost as good tresults as GSF, but 10 times faster.
- Using normal Chi2 fit, electron momentum would be overestimated as all energy loss terms take average energy loss value in fixed manner.

- Advantage of running electron track recovery with standard reco:
	- do not need to re-do many of combinatorial aspects of pattern rec
	- no need to merge track collections - CPU intensive
	- all tracks reconstruction used in subsequent steps so no inconsistencies.
- Advantages of better track reco:
	- tracks on avg have more pix and SCT hits, and less have failed TRT extensions
	- track param res slightly imporved
	- track reco efficiency improved, especially for electrons that brem in PIX and between PIX and SCT

Electron Reco improvement 2012
------------------------------
- Preselect electron tracks to refit with GSF (cannot refit everything as takes factor 10 longer)
- Need to recover tracks that potentially have large brem lost and were badly fitted.
- Preselect two categories of track:
	- "norma" tracks delta_eta < 0.05, delta_phi < 0.05 (0.2) on side affected (not) but brem
	- tracks with p scaled to cl_E before extrapolation with delta_eta < 0.05, delta_phi < 0.05 (0.1) on side affected (not) but brem
	- second matching aims to select tracks with low p tha have suffered large brem
- Refit tracks with silicon hits using GSF
- Refitted tracks then used for cluster matching

- Improve final matching...
	- again check deltaR and deltaR_rescaled
	- tow favour primary electron track and prevent random matches in cascades/trident from brem,
	- prefer tracks with pix hits
	- If more than 2 track  with pix hits, and difference in delta_R_rescaled is large enough, take one with smallest delta_R_rescaled. Otherwise take one with smallest delta_R as long as they are different enough.
	- If they have similar delta_R and delta_R_rescaled, assume do not have enough info to be fully resoved and take one with most pix hits, giving most weight to first layer.
	
- overall reco efficiency increases by ~1% in the calo barrel and ~5% in endcaps for et 30-50, and up to 8% for low Et

